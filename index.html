<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Functional PHP</title>

    <meta name="description" content="A framework for easily creating beautiful presentations using HTML">
    <meta name="author" content="Hakim El Hattab">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/default.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->

    <style>
      q:before {
        content: '\201C';
      }
      q:after {
        content: '\201D';
      }

      .reveal section img {
        border: 0px;
        box-shadow: none;
        background: none;
      }
    </style>

  </head>

  <body>
    <div class="reveal">

      <div class="slides">
        <section>
          <h1>Functional PHP</h1>
          <p>
            <small>Presented by <a href="http://www.garfieldtech.com/">Larry Garfield</a> (<a href="http://twitter.com/Crell">@Crell</a>)</small>
          </p>
        </section>

        <section>
          <section data-background="assets/pocket-protector.jpg">
            <div style="font-weight: bold; position: relative; top: -3em; text-shadow: 2px 2px 2px #000;">
              <p>Warning, hard core geek action</p>
              <p>Please pardon the nerd</p>
            </div>
          </section>
          <section data-background="assets/drupal-delorean.jpg">
            <div style="font-weight: bold; position: relative; top: 10em; text-shadow: 2px 2px 2px #000;">
              <p>But first a little history</p>
            </div>
          </section>
          <section>
            <!-- Needs proper layout -->
            <h2>Von Neumann Architecture</h2>
            <div style="width: 40%; float: right; border: 1px;">
              <img src="assets/john-von-neumann.gif" data-credit="http://en.wikipedia.org/wiki/File:JohnvonNeumann-LosAlamos.gif" />
            </div>

            <ul style="float: left;">
              <li><a href="http://en.wikipedia.org/wiki/John_von_Neumann">John Von Neumann</a>, 1903-1957</li>
              <li class="fragment">Mathematician, Physicist, all-around genius</li>
              <li class="fragment">Set theory, Operator theory, quantum theory, nuclear physics...</li>
              <li class="fragment">One of those ridiculously smart people who don't get enough credit for how much they change the world.</li>
            </ul>
          </section>
          <section>
            <h2>Von Neumann Architecture</h2>
            <img src="assets/Computer_system_bus.svg" alt="Computer system bus" data-credit="http://en.wikipedia.org/wiki/File:Computer_system_bus.svg" />
            <p class="fragment">Programs are data, not hardware</p>
          </section>
          <section>
            <h2>Von Neumann Architecture</h2>
            <ul>
              <li class="fragment">A program is just data: "Stored Program" concept</li>
              <li class="fragment">A program is a series of steps</li>
              <li class="fragment">Steps execute in linear sequence</li>
              <li class="fragment">Steps alter memory registers</li>
              <li class="fragment">Steps can alter the next step</li>
            </ul>
          </section>
          <section>
            <h2>Imperative Programming</h2>
            <ul>
              <li class="fragment">Imperative "mood"</li>
              <li class="fragment">Series of precise commands</li>
              <li class="fragment">State: values that get changed over time by commands</li>
              <li class="fragment">The purpose of commands is to alter state</li>
            </ul>

            <p class="fragment" style="margin-top: 2em;">This is what all modern hardware does</p>
          </section>
          <section>
            <p>Imperative Programming is following a recipe for a cake</p>
            <aside class="notes">
              <ul>
                <li>Constantly manipulating the same state</li>
                <li>The state is computer memory</li>
              </ul>
            </aside>
          </section>
        </section>
        <section>
          <section>
            <h2>Procedural Programming</h2>
            <ul>
              <li class="fragment">Imperative Programming: Evolved</li>
              <li class="fragment">Procedure = subroutine = reusable series of commands</li>
              <li class="fragment">Structured Programming: High-level abstractions
                <ul>
                  <li><code>if-then</code></li>
                  <li><code>while</code></li>
                  <li><code>for</code></li>
                </ul>
              </li>
            </ul>
            <pre class="fragment"><code>
              Var MyList [5, 7, 2, 9, 2]
              Var Biggest
              Procedure FindBiggest
                For MyList As Item
                  If Item > Biggest Then
                    Biggest = Item
                  End If
                End For
                Return
              End Procedure

              Call FindBiggest
              Print Biggest
            </code></pre>
          </section>
          <section>
            <div class="vcenter">
              <p>Imperative Programming is following a recipe for a cake</p>
              <p style="margin-top: 1em;">Procedural Programming is singing a song with a refrain</p>
            </div>
          </section>
          <section class="slide">
            <p>Imperative Programming defines <br /><em>how</em> a program should work.</p>
          </section>
        </section>
        <section>
          <section>
            <h2>Declarative programming</h2>
            <p class="fragment">Declarative Programming defines <br /><em>what</em> a program should accomplish.</p>
            <aside class="notes">
              <ul>
                <li>SQL</li>
                <li>CSS</li>
                <li>DI config files</li>
                <li>Spreadsheets</li>
              </ul>
            </aside>
          </section>
          <section>
            <h2>John Backus</h2>
            <!-- Needs layout work. -->
            <div style="width: 50%; float: right; border: 1px;">
              <img style="max-width: 80%; max-height: 80%;" src="assets/john-backus.jpg" data-credit="http://en.wikipedia.org/wiki/File:John_Backus.jpg" />
            </div>
            <ul>
              <li><a href="http://en.wikipedia.org/wiki/John_Backus">John Backus</a>, 1924-2007</li>
              <li class="fragment">Invented FORTRAN, 1953</li>
              <li class="fragment">As penance...
                <ul>
                  <li class="fragment">Developed Backus-Naur Form (BNF)</li>
                  <li class="fragment">Co-developed Algol</li>
                  <li class="fragment">Function-level Programming (FP), 1977</li>
                </ul>
              </li>
            </ul>
            <p style="clear: both; margin-top: 2em;" class="fragment">"Can Programming Be Liberated From the von Neumann Style? A Functional Style and its Algebra of Programs"</p>
            <aside class="notes">
              Functional like math, not functional like "working".
              Bakus didn't invent it.
              LISP claims to, like everything else.
            </aside>
          </section>
          <section>
            <h2>Functional programming</h2>
            <p>Declare your algorithm</p>
            <p class="fragment">The compiler optimizes for you</p>
          </section>
          <section>
            <h2>Functional programming</h2>
            <ul>
              <li class="fragment">Pure functions</li>
              <li class="fragment">Higher-order functions / First-class functions</li>
              <li class="fragment">Immutable variables</li>
            </ul>
          </section>
          <section>
            <p>So what?</p>
            <img style="width: 80%" src="assets/this-is-sparta.jpg" alt="This is PHP!" data-source="http://socialnewsdaily.com/13755/this-is-chitown-nate-robinson-compares-bulls-to-300-on-twitter/" />
            <h2 style="font-weight: bold; position: relative; top: -1.5em; text-shadow: 2px 2px 2px #000;">This is PHP!</h2>
          </section>
          <section>
            <p>Functional languages enforce what is<br />simply "good code" in other languages</p>
          </section>
        </section>
        <section>
          <section>
            <h2>Pure functions</h2>
            <ul>
              <li class="fragment">No side-effects (including I/O)</li>
              <li class="fragment">Explicit function input/output</li>
              <li class="fragment">Stateless</li>
              <li class="fragment">Takes clear input, gives clear output: <em>that's it</em></li>
            </ul>
          </section>
          <section>
            <h2>Pure functions</h2>
            <pre><code class="php">
function theme_list(array $items, $type = 'ul') {
  $output = '';
  foreach ($items as $item) {
    $output .= '<li>' . $item . '</li>';
  }
  return "<{$type}>" . $output . '<' . '/' . $type . '>';
}
            </code></pre>
          </section>
          <section>
            <h2>Pure functions</h2>
            <ul>
              <li class="fragment">Easy testability</li>
              <li class="fragment">Not SAD (Spooky Action at a Distance)</li>
              <li class="fragment">Self-contained</li>
              <li class="fragment">Idempotent</li>
            </ul>
            <p style="margin-top: 1em;" class="fragment">Where have we seen this before...?</p>
          </section>
          <section>
            <h2>Service objects</h2>
            <ul>
              <li class="fragment">Stateless</li>
              <li class="fragment">Single-purpose</li>
              <li class="fragment">Idempotent (usually)</li>
              <li class="fragment">No non-I/O side-effects</li>
            </ul>
            <p style="margin-top: 1em;" class="fragment">Good service objects are pure functions</p>
          </section>
        </section>
        <section>
          <section class="slide">
            <h2>First-class functions</h2>
            <ul>
              <li class="fragment">Functions can be a variable</li>
              <li class="fragment">Functions can be a parameter</li>
              <li class="fragment">Functions can be a return type</li>
            </ul>
            <pre class="fragment"><code class="php">
  $function = function($value) {
    return $value * 5;
  };
  $function($a);
            </code></pre>
          </section>

          <section class="slide">
            <h2>First-class functions</h2>
            <ul>
              <li class="fragment">Strategy pattern</li>
              <li class="fragment">Lazy-evaluation</li>
              <li class="fragment">Partial evaluation / Currying</li>
            </ul>
            <p style="margin-top: 1em;" class="fragment">Or just a really cool shorthand for objects</p>
          </section>
          <section>
            <h2>Anonymous functions</h2>
            <pre><code class="php">$find_pair = function ($card1, $card2) {
  return ($card1->value == $card2->value);
};

$is_pair = $find_pair(new Card('2H'), new Card('8D'));</code></pre>

            <div class="fragment">
              <div>==</div>
              <pre><code class="php">class FindPair {
  public function __invoke($card1, $card2) {
    return ($card1->value == $card2->value);
  }
}

$find_pair = new FindPair();
$is_pair = $find_pair(new Card('2H'), new Card('8D'));</code></pre>
            </div>
          </section>

          <section>
            <h2>Closures</h2>
            <pre><code class="php">$wild = new Card('5H');
$find_pair = function ($card1, $card2) use ($wild) {
  return ($card1->value == $card2->value
    || $wild->value == $card1->value && $wild->suit == $card1->suit
    || $wild->value == $card2->value && $wild->suit == $card2->suit);
};

$is_pair = $find_pair(new Card('2H'), new Card('8D'));</code></pre>

            <div class="fragment">
              <div>==</div>
              <pre><code class="php">$wild = new Card('5H');
class FindPair {
  protected $wild;
  public function __construct($wild) {
    $this->wild = $wild;
  }
  public function __invoke($card1, $card2) {
    return ($card1->value == $card2->value
      || $this->wild->value == $card1->value && $this->wild->suit == $card1->suit
      || $this->wild->value == $card2->value && $this->wild->suit == $card2->suit);
  }
}
$find_pair = new FindPair($wild);
$is_pair = $find_pair(new Card('2H'), new Card('8D'));</code></pre>
            </div>
          </section>

          <section>
            <h2>Layering functions</h2>
            <pre><code class="php">$wild = new Card('5H');

$is_wild = function($card) use ($wild) {
  return $wild->value == $card->value && $wild->suit == $card->suit;
}

$find_pair = function ($card1, $card2) use ($is_wild) {
  return ($c1->value == $c2->value || $is_wild($c1) || $is_wild($c2));
};

$is_pair = $find_pair(new Card('2H'), new Card('8D'));</code></pre>
            <aside class="notes">
              This looks an awful lot like Dependency Injection to me...
            </aside>
          </section>

          <section class="slide">
            <h2>Delayed execution</h2>
            <pre><code class="php">class Container {
  protected $factories = array();

  public function __set($key, $func) {
    $this->factories[$key] = $func;
  }

  public function __get($key) {
    return $this->factories[$key]($this);
  }
}</code></pre>

            <div class="fragment">
              <pre><code class="php">$container = new Container();
$container->conn = function($c) {
  return new DatabaseConnection($c->info);
};
$container->info = function() { return ['user'=>'me', 'pass'=>'hi']; };

$conn = $container->conn;
$conn->query('...');</code></pre>
            </div>

            <p class="fragment">Hey, look, a Dependency Injection Container!</p>

            <div style="text-align: center; margin-top: 1em;" class="fragment">See also: <a href="http://pimple.sensiolabs.org/">Pimple</a></div>
          </section>
          <section>
            <h2>Importing</h2>
              <pre class="fragment"><code class="php">abstract class Importer {
  public function __construct(MapInterface $map) { $this->map = $map; }
  public function mapData($source) {
    $dest = $this->repository->create('someType');
    foreach ($this->map->mapping() as $field => $callback) {
      $dest->$field = $callback($source);
    }
    return $dest;
  }
}
</code></pre><pre class="fragment"><code class="php">class MyMapper implements MapInterface {
  public function mapping() {
    $proc = $this->someUtilityService;
    $map['title'] = function($source) use ($proc) {
      return strip_tags($proc->extract('label', $source));
    };
    $map['body'] = function($source) use ($proc) {
      return $proc->extract('body', $source);
    };
    $map['extra'] = function($source) {
      return "Some hard coded value";
    };
    return $map;
  }
}
</code></pre><pre class="fragment"><code class="php">$importer = new Importer(new MyMapper());
$my_object = $importer->mapData($fancy_external_data_object);
</code></pre>
            <aside class="notes">
              <ul>
                <li>An import engine that fits on one slide.</li>
                <li>Both classes are immutable: Idempotent; REUSE!</li>
                <li>Doing this on CLI? ... Could you fork?</li>
              </ul>
            </aside>
          </section>
        </section>
        <section>
          <section>
            <h2>Functional tools</h2>
          </section>
          <section>
            <h2>Map/Reduce</h2>
            <ul>
              <li class="fragment">"Embarrassingly Parallel" Problems</li>
              <li class="fragment">Map
                <ol>
                  <li>Divide a problem into (identical) sub-problems</li>
                  <li>Distribute to separate workers</li>
                </ol>
              </li>
              <li class="fragment">Reduce
                <ol>
                  <li>Collect answers</li>
                  <li>Combine back together</li>
                </ol>
              </li>
              <li class="fragment">Really useful for epically huge data sets</li>
            </ul>
          </section>
          <section>
            <h2>Map/Reduce</h2>
            <ul>
              <li class="fragment">Could get very complicated, or...</li>

              <li class="fragment" style="list-style-type: none;">
                <pre class="fragment"><code class="php">$result = array_map($callback, $array);

$result = array_map(function($a) {
  // Your logic here.
}, $array);

$result = array_map(function($a, $b) {
  // Your logic here.
}, $array1, $array2);
                </code></pre>
              </li>
              <li class="fragment"><code>foreach()</code>, but separates application from loop</li>
              <li class="fragment">Slightly slower, but not enough to care</li>
            </ul>
            <aside class="notes">
              <ul>
                <li>First: any callable</li>
                <li>Second: Inline makes one-off functions unnecessary.</li>
                <li>Third: combine arrays, produce one result.</li>
                <li>array_map() doesn't work on iterables :-(</li>
              </ul>
            </aside>
          </section>
          <section>
            <h2>Declarative PHP</h2>
<pre class="fragment"><code class="php">$importer = new Importer(new MyMapper());
foreach ($array_of_external_objects as $object) {
  $my_objects[] = $importer->mapData($object);
}
</code></pre><pre class="fragment"><code class="php">$apply = function($callback, Iterator $i) {
  $ret = [];
  foreach ($i as $object) {
    $ret[] = $callback($object);
  }
  return $ret;
}

$importer = new Importer(new MyMapper());

$my_objects = $apply([$importer, 'mapData'], $iter_of_objects);
</code></pre>

          </section>

        </section>
        <section>
          Outline:

          Procedural code: Define
          FP code: Define
          Principles of FP:
          - Pure functions (Idempotency)
          - Higher-order functions
          - Immutable variables
          So what?  PHP isn't functional or concurrent.
          => Principles are *the same* as "good code" principles

          FP applied to OOP:
          - Pure functions: stateless services
          - Higher-order functions: Super-useful shorthand for objects
          -- Pimple
          -- Import mapper
          -- array_map() et al
          - Immutable variables: Avoids state questions. Value objects
          - Currying: Worker factories (build objects that do things, based on pre-set values)
          - Memoization: FP does it automatically, you do it yourself; Purity makes it easier
          - Algorithm-first:
          -- API defines WHAT should happen. Build that first.
          -- Test it.
          -- Worry about HOW later.




        </section>

      </div>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>

  </body>
</html>
